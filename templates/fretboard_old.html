<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FretWizard - fretboard_old</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <style>
        body {
            font-family: Arial, sans-serif;
            color: black;
        }
    
        .fretboard_old {
            width: 100%;
            border-collapse: collapse;
        }
    
        .fretboard_old th, .fretboard_old td {
            border: 1px solid black;
            padding: 4px;
            text-align: center;
        }
    
        .string {
            background-color: #f2f2f2;
        }
    
        .fret {
            background-color: #e6e6e6;
        }
        .note {
            display: inline-block;
            width: 30px;
            height: 30px;
            line-height: 30px;
            border-radius: 50%;
            background-color: #4CAF50;
            color: white;
            font-weight: bold;
        }
        
        .table {
            display: none;
        }

    </style>
</head>
<body>
    <h1>fretboard_old for {{ instrument }}</h1>
    <a href="/">Back to Change Instrument</a>
    <p>Selected Tuning: {{ inverted_tuning|join(', ') }}</p>

    <form method="post" id="fretboard_oldForm">
        {% for string in tuning %}
            <input type="hidden" name="tuning[]" value="{{ string }}">
        {% endfor %}
        
        <label for="key">Select a Key:</label>
        <select name="key" required>
            {% for note in ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'] %}
                <option value="{{ note }}">{{ note }}</option>
            {% endfor %}
        </select>
        <br>

        <label for="scale_type">Select Scale Type:</label>
        <select name="scale_type" required>
            <option value="major">Major</option>
            <option value="minor">Minor</option>
        </select>
        <br>

        <input type="submit" value="Show fretboard_old">
    </form>

    <!-- fretboard_old layout -->
    {% if selected_key and notes_in_key %}
        <table class="table" id="fretboard_oldTable">
        <thead>
            <tr>
                <th>String</th>
                {% for fret in range(1, 13) %}
                    <th>Fret {{ fret }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for string in tuning %}
                <tr>
                    <td class="string">{{ string }}</td>
                    {% for fret in range(1, 13) %}
                        <!-- Calculate the note at this fret -->
                        {% set note = get_note_at_fret(string, fret) %}
                        <!-- Display the note if it's in the selected key -->
                        <td class="fret">
                            {% if note in notes_in_key %}
                                <span class="note">{{ note }}</span> <!-- Apply the .note class here -->
                            {% endif %}
                        </td>
                    {% endfor %}
                </tr>
            {% endfor %}
        </tbody>
        </table>
    {% endif %}

    {% if instrument_image %}
    <img src="{{ instrument_image }}" alt="{{ session['instrument'] }} Image">
    {% else %}
    <p>No image available</p>
    {% endif %}
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var form = document.getElementById('fretboard_oldForm');
            form.onsubmit = function(e) {
                e.preventDefault(); // Prevent the default form submission
                var formData = new FormData(form);
                
                fetch('/fretboard_old', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.text())
                .then(html => {
                    var parser = new DOMParser();
                    var doc = parser.parseFromString(html, 'text/html');
                    var table = doc.getElementById('fretboard_oldTable');
                    var currentTable = document.getElementById('fretboard_oldTable');
                    
                    // Replace the current table with the new one from the response
                    if (currentTable && table) {
                        currentTable.parentNode.replaceChild(table, currentTable);
                    }
                    
                    // Show the table
                    if (table) {
                        table.style.display = 'table'; // Change the display style to show the table
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            };
        });
        </script>
    
</body>
</html>
